<template>
    <div class="mainContainer" style="overflow: hidden;display: flex;flex-direction: row">
      <div class="leftContainer">
        <h1 @click="changeComponent('introduce')">{{loginInfo.name}}<br/>你好</h1>
        <div class="buttonsContainer">
          <div v-if="loginInfo.authorities[0].role === 'ROLE_ADMIN'">
            <div class="divButton flexCenter" @click="changeComponent('accountManage')">
              <h3>账户管理</h3>
            </div>
            <div class="divButton flexCenter" @click="changeComponent('userManage')">
              <h3>用户管理</h3>
            </div>
            <div class="divButton flexCenter" @click="changeComponent('studentManage')">
              <h3>学生管理</h3>
            </div>
            <div class="divButton flexCenter" @click="changeComponent('noticeManage')">
              <h3>校园公告</h3>
            </div>
          </div>
          <div v-if="loginInfo.authorities[0].role === 'ROLE_STUDENT'">
            <div class="divButton flexCenter" @click="changeComponent('accountManage')">
              <h3>账户管理</h3>
            </div>
            <div class="divButton flexCenter" @click="changeComponent('studentPay')">
              <h3>学生缴费</h3>
            </div>
            <div class="divButton flexCenter" @click="changeComponent('noticeManage')">
              <h3>校园公告</h3>
            </div>
          </div>
          <div v-if="loginInfo.authorities[0].role === 'ROLE_FINANCE'">
            <div class="divButton flexCenter" @click="changeComponent('accountManage')">
              <h3>账户管理</h3>
            </div>
            <div class="divButton flexCenter" @click="changeComponent('paymentManage')">
              <h3>缴费管理</h3>
            </div>
            <div class="divButton flexCenter" @click="changeComponent('noticeManage')">
              <h3>校园公告</h3>
            </div>
          </div>
        </div>
      </div>
      <div class="rightContainer">
        <component :is="rightComponent"></component>
      </div>
    </div>
</template>

<script>
import auth from '../api/auth'
import accountManage from './index/accountManage'
import userManage from './index/userManage'
import studentManage from './index/studentManage'
import paymentManage from './index/paymentManage'
import studentPay from './index/studentPay'
import introduce from './index/introduce'
import noticeManage from './index/noticeManage'

export default {
  name: 'index',
  data () {
    return {
      loginInfo: null,
      rightComponent: introduce
    }
  },
  methods: {
    changeComponent: function (target) {
      switch (target) {
        case 'accountManage':
          this.rightComponent = accountManage
          break
        case 'userManage':
          this.rightComponent = userManage
          break
        case 'studentManage':
          this.rightComponent = studentManage
          break
        case 'paymentManage':
          this.rightComponent = paymentManage
          break
        case 'studentPay':
          this.rightComponent = studentPay
          break
        case 'introduce':
          this.rightComponent = introduce
          break
        case 'noticeManage':
          this.rightComponent = noticeManage
          break
      }
    }
  },
  created () {
    auth.loginInfo().then(resp => {
      this.loginInfo = resp
    }).catch(reason => {
      if (reason.message === 'User not login') {
        this.$message.error('用户未登陆！3秒后跳转到登陆界面。')
        setTimeout(() => {
          this.$router.push('/')
        }, 3000)
      } else {
        this.$message.error('获取登陆信息失败！')
      }
    })
  }
}
</script>

<style src="../style/index.less" lang="less" scoped></style>
